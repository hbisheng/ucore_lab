# Lab 2实验报告
## 2012011307 黄必胜

Lab2 总体完成情况： 参考注释以及实现的提示，完成了lab2的基本功能，包括First fit算法的实现，和虚地址在二级页表项中的映射。没有实现challenge。

### 练习1
---

1. <b>实现first-fit连续物理内存分配算法。</b>
> 参考原有的基本算法样例，已在ucore中实现。

2. <b>你的first fit算法是否有进一步的改进空间？</b>
> 暂时没有想到。

### 练习2
---
1. <b>实现寻找虚拟地址对应的页表项。</b>
> 已经参照lab中的注释的步骤实现。

2. <b>请描述页目录项（Page Director Entry）和页表项（Page Table Entry）中每个组成部分的含义和以及对ucore而言的潜在用处。</b>

> 页目录项PDE: 32位，前20位为页表物理地址的前20位，后12位包含了该页目录项的信息，包括保留位、访问位、可写位、权限位等  
> 页表项PTE：32位，前20位位对应页帧物理地址的前20位，后12位包含了该页表项的信息，包括保留位、访问位、可写位、权限位等  
> 在ucore中，明确这些位的意义可以规范地使用页表的映射机制等，包括正确的权限管理和合法的读写操作  

3. <b>如果ucore执行过程中访问内存，出现了页访问异常，请问硬件要做哪些事情？</b>

> CPU：产生中断，交由操作系统处理  
> 内存、硬盘：传输入相应缺失页  

### 练习3
---
1. <b>释放某虚地址所在的页并取消对应二级页表项的映射。</b>
> 已参照lab中的注释步骤实现。

2. <b>数据结构Page的全局变量（其实是一个数组）的每一项与页表中的页目录项和页表项有无对应关系？如果有，其对应关系是啥？</b>

> 没分配的Page无相关  
> 而已分配的Page地址的前20位与某些页表项的前20位相等，对应了一个虚地址  

3. <b>如果希望虚拟地址与物理地址相等，则需要如何修改lab2，完成此事？ </b>

> 页目录项和页表项放在内存靠前的位置，并做对等映射  
> 在进行虚地址的转换时，直接分配地址相同的物理地址  

### 与标准答案的差异
---
1. 练习1中实现first-fit时，每次都将空闲内存空间插入到free_list之中合适的位置，然后尝试与周围两个page合并。与参考答案中直接插入free_list头有所区别。
2. 页模式的过程按照注释中的步骤完成，与标准答案基本相同。

### 本实验中重要的知识点
---
1. 内存分配算法。原理中讲了最先分配、最优分配、最差分配、buddy system，实验中实现了最先分配。
2. 页模式的机制。原理中讲了两级页表的具体页映射流程，在spoc课上也利用高级语言进行了尝试。而这知识在ucore实验中的得到进一步巩固。

### OS原理中很重要但在实验中没有对应上的知识点
---
1. 对拥有不同作用的各部分地址的划分过程。
2. 其他的内存分配算法在ucore中的实现方法。
 
